# 任务选项命令行视图

<cite>
**本文档引用的文件**
- [TaskOptions.vue](file://src/frontEnd/src/views/TaskDetail/components/TaskOptions.vue)
- [task.ts](file://src/frontEnd/src/types/task.ts)
- [taskService.py](file://src/backEnd/service/taskService.py)
- [Task.py](file://src/backEnd/model/Task.py)
- [useTaskDetail.ts](file://src/frontEnd/src/views/TaskDetail/composables/useTaskDetail.ts)
- [task.ts](file://src/frontEnd/src/stores/task.ts)
- [TaskDetail.vue](file://src/frontEnd/src/views/TaskDetail/index.vue)
</cite>

## 目录
1. [简介](#简介)
2. [功能概述](#功能概述)
3. [核心组件分析](#核心组件分析)
4. [命令行视图实现](#命令行视图实现)
5. [参数映射与转换](#参数映射与转换)
6. [用户交互功能](#用户交互功能)
7. [数据流分析](#数据流分析)

## 简介
任务选项命令行视图是SQLMapWebUI系统中的一个重要功能模块，它为用户提供了一种直观的方式查看和理解SQLMap扫描任务的配置参数。该视图允许用户在表格视图和命令行视图之间切换，特别地，命令行视图将任务配置参数转换为标准的SQLMap命令行格式，便于用户理解和复用。

## 功能概述
任务选项命令行视图主要提供以下功能：
- 在表格视图和命令行视图之间切换显示模式
- 将任务配置参数转换为SQLMap命令行格式
- 支持搜索和过滤功能
- 提供复制完整命令行的功能
- 显示参数统计信息

该功能位于任务详情页面的"扫描配置"标签页中，是用户了解和分析扫描任务配置的重要工具。

## 核心组件分析

### 任务选项组件 (TaskOptions.vue)
任务选项组件是实现命令行视图的核心，它负责渲染和管理任务配置的显示。该组件提供了两种视图模式：表格视图和命令行视图。

```mermaid
classDiagram
class TaskOptions {
+viewMode : 'table' | 'cmdline'
+searchQuery : string
+sortOrder : 'default' | 'asc' | 'desc'
+optionToCmdMap : Record<string, string>
+skipOptions : Set<string>
+cmdlineArgs : ComputedRef<string[]>
+filteredCmdlineArgs : ComputedRef<string[]>
+fullCommandLine : ComputedRef<string>
+getArgClass(arg : string) : string
+highlightCmdlineArg(arg : string) : string
+copyCommandLine() : void
+formatOptionKey(key : string) : string
+formatOptionValue(value : any, key : string) : string
}
```

**组件来源**
- [TaskOptions.vue](file://src/frontEnd/src/views/TaskDetail/components/TaskOptions.vue)

### 任务数据模型 (task.ts)
任务数据模型定义了任务配置选项的接口，为前端组件提供了类型定义。

```mermaid
classDiagram
class TaskOptions {
+level? : number
+risk? : number
+technique? : string
+dbms? : string
+threads? : number
+[key : string] : any
}
class Task {
+engineid : number
+taskid : string
+scanUrl : string
+host : string
+status : TaskStatus
+createTime : string
+startTime? : string
+headers? : string[]
+body? : string
+options? : TaskOptions
+updateTime? : string
+remote_addr? : string
+injected? : boolean
+errors? : number
+logs? : number
}
```

**模型来源**
- [task.ts](file://src/frontEnd/src/types/task.ts)

## 命令行视图实现
命令行视图的实现主要依赖于`TaskOptions.vue`组件中的计算属性和方法。当用户切换到命令行视图时，系统会将任务配置参数转换为标准的SQLMap命令行格式。

### 命令行参数转换
系统通过`optionToArg`函数将任务配置选项转换为命令行参数。该函数处理了不同类型的值（布尔值、数组、字符串等）的转换逻辑。

```mermaid
flowchart TD
Start([开始转换]) --> CheckSkip["检查是否为内部选项"]
CheckSkip --> |是| ReturnNull["返回null"]
CheckSkip --> |否| CheckValue["检查值是否为空"]
CheckValue --> |是| ReturnNull
CheckValue --> |否| CheckType["检查值类型"]
CheckType --> |布尔值| HandleBoolean["处理布尔值"]
CheckType --> |数组| HandleArray["处理数组值"]
CheckType --> |字符串/数字| HandleString["处理字符串/数字"]
HandleBoolean --> BuildArg["构建参数"]
HandleArray --> BuildArg
HandleString --> BuildArg
BuildArg --> End([返回参数字符串])
```

**实现来源**
- [TaskOptions.vue](file://src/frontEnd/src/views/TaskDetail/components/TaskOptions.vue#L275-L311)

## 参数映射与转换
系统通过`optionToCmdMap`对象定义了任务配置选项与SQLMap命令行参数之间的映射关系。

```mermaid
erDiagram
OPTION_MAP ||--o{ COMMAND_LINE : "映射"
OPTION_MAP {
string key
string value
}
COMMAND_LINE {
string flag
string value
string format
}
OPTION_MAP ||--o{ REQUEST : "请求相关"
OPTION_MAP ||--o{ DETECTION : "检测相关"
OPTION_MAP ||--o{ PERFORMANCE : "性能相关"
OPTION_MAP ||--o{ ENUMERATION : "枚举相关"
OPTION_MAP ||--o{ OUTPUT : "输出相关"
REQUEST {
string requestFile
string url
string data
string cookie
string headers
string userAgent
string proxy
}
DETECTION {
string level
string risk
string technique
string dbms
}
PERFORMANCE {
string threads
string timeout
string retries
string delay
}
ENUMERATION {
string getDbs
string getTables
string getColumns
string dumpTable
string dumpAll
}
OUTPUT {
string outputDir
string csvDel
string dumpFormat
}
```

**映射来源**
- [TaskOptions.vue](file://src/frontEnd/src/views/TaskDetail/components/TaskOptions.vue#L204-L269)

## 用户交互功能
命令行视图提供了丰富的用户交互功能，包括搜索、复制和统计信息显示。

### 复制命令行功能
用户可以一键复制完整的命令行参数，便于在其他环境中使用。

```mermaid
sequenceDiagram
participant User as "用户"
participant UI as "UI组件"
participant Clipboard as "剪贴板"
participant Toast as "提示组件"
User->>UI : 点击"复制命令"按钮
UI->>UI : 构建完整命令行
UI->>Clipboard : 调用clipboard.writeText()
Clipboard-->>UI : 复制成功
UI->>Toast : 显示成功提示
Toast-->>User : "已复制到剪贴板"
alt 复制失败
Clipboard-->>UI : 复制失败
UI->>Toast : 显示错误提示
Toast-->>User : "复制失败"
end
```

**交互来源**
- [TaskOptions.vue](file://src/frontEnd/src/views/TaskDetail/components/TaskOptions.vue#L434-L452)

## 数据流分析
任务选项命令行视图的数据流涉及前端组件、API服务和后端服务的交互。

```mermaid
graph TD
A[任务详情页面] --> B[useTaskDetail组合式函数]
B --> C[taskStore状态管理]
C --> D[taskService后端服务]
D --> E[Task模型]
E --> F[SQLMap引擎]
F --> E
E --> D
D --> C
C --> B
B --> A
A --> G[TaskOptions组件]
G --> H[命令行视图]
H --> I[参数映射]
I --> J[格式化输出]
J --> K[用户界面]
style A fill:#f9f,stroke:#333
style B fill:#bbf,stroke:#333
style C fill:#f96,stroke:#333
style D fill:#6f9,stroke:#333
style E fill:#9f6,stroke:#333
style F fill:#69f,stroke:#333
style G fill:#f66,stroke:#333
style H fill:#66f,stroke:#333
style I fill:#6f6,stroke:#333
style J fill:#f6f,stroke:#333
style K fill:#ff6,stroke:#333
```

**数据流来源**
- [TaskDetail.vue](file://src/frontEnd/src/views/TaskDetail/index.vue)
- [useTaskDetail.ts](file://src/frontEnd/src/views/TaskDetail/composables/useTaskDetail.ts)
- [task.ts](file://src/frontEnd/src/stores/task.ts)
- [taskService.py](file://src/backEnd/service/taskService.py)
- [Task.py](file://src/backEnd/model/Task.py)