# 前端架构

<cite>
**本文档引用的文件**  
- [package.json](file://src/frontEnd/package.json)
- [vite.config.ts](file://src/frontEnd/vite.config.ts)
- [main.ts](file://src/frontEnd/src/main.ts)
- [App.vue](file://src/frontEnd/src/App.vue)
- [Layout.vue](file://src/frontEnd/src/views/Layout.vue)
- [router/index.ts](file://src/frontEnd/src/router/index.ts)
- [router/guards.ts](file://src/frontEnd/src/router/guards.ts)
- [stores/index.ts](file://src/frontEnd/src/stores/index.ts)
- [stores/auth.ts](file://src/frontEnd/src/stores/auth.ts)
- [stores/task.ts](file://src/frontEnd/src/stores/task.ts)
- [stores/config.ts](file://src/frontEnd/src/stores/config.ts)
- [api/index.ts](file://src/frontEnd/src/api/index.ts)
- [api/request.ts](file://src/frontEnd/src/api/request.ts)
- [types/common.ts](file://src/frontEnd/src/types/common.ts)
- [types/api.ts](file://src/frontEnd/src/types/api.ts)
- [types/task.ts](file://src/frontEnd/src/types/task.ts)
- [utils/auth.ts](file://src/frontEnd/src/utils/auth.ts)
- [utils/storage.ts](file://src/frontEnd/src/utils/storage.ts)
</cite>

## 目录
1. [项目结构](#项目结构)
2. [技术栈概述](#技术栈概述)
3. [组件化设计模式](#组件化设计模式)
4. [Pinia状态管理](#pinia状态管理)
5. [Vue Router路由配置](#vue-router路由配置)
6. [Vite构建工具优化](#vite构建工具优化)
7. [TypeScript类型系统应用](#typescript类型系统应用)

## 项目结构

根据项目目录结构，前端代码位于`src/frontEnd`目录下，采用典型的Vue 3 + TypeScript项目组织方式。项目结构清晰地划分了不同类型的文件和模块，便于维护和扩展。

```mermaid
graph TB
subgraph "src/frontEnd"
subgraph "src"
subgraph "api"
api["auth.ts<br>task.ts<br>headerRule.ts<br>request.ts"]
end
subgraph "assets"
assets["styles/<br>images/"]
end
subgraph "components"
components["GuidedParamEditor.vue<br>HttpCodeEditor.vue<br>TaskFilter.vue"]
end
subgraph "router"
router["index.ts<br>guards.ts"]
end
subgraph "stores"
stores["auth.ts<br>task.ts<br>config.ts"]
end
subgraph "types"
types["common.ts<br>api.ts<br>task.ts<br>headerRule.ts"]
end
subgraph "utils"
utils["auth.ts<br>storage.ts<br>useSmartPolling.ts"]
end
subgraph "views"
views["Home/index.vue<br>TaskList/index.vue<br>TaskDetail/index.vue<br>Config/index.vue"]
end
main["main.ts"]
App["App.vue"]
end
config["vite.config.ts"]
package["package.json"]
end
```

**图源**  
- [vite.config.ts](file://src/frontEnd/vite.config.ts)
- [package.json](file://src/frontEnd/package.json)

**本节来源**  
- [vite.config.ts](file://src/frontEnd/vite.config.ts)
- [package.json](file://src/frontEnd/package.json)

## 技术栈概述

sqlmapWebUI前端采用Vue 3 + TypeScript技术栈构建，结合了现代前端开发的最佳实践。项目使用Vite作为构建工具，提供了快速的开发服务器和高效的生产构建。状态管理采用Pinia，路由管理使用Vue Router 4，UI组件库采用PrimeVue。

项目依赖的主要技术栈包括：
- **Vue 3**: 使用Composition API和<script setup>语法糖
- **TypeScript**: 提供完整的类型安全和开发体验
- **Vite**: 作为构建工具和开发服务器
- **Pinia**: 状态管理库
- **Vue Router**: 路由管理
- **PrimeVue**: UI组件库
- **Axios**: HTTP客户端
- **Sass**: CSS预处理器

**本节来源**  
- [package.json](file://src/frontEnd/package.json)

## 组件化设计模式

项目采用组件化设计模式，将UI划分为不同类型的组件，包括视图组件、功能组件和UI组件。这种分层设计提高了代码的可维护性和复用性。

### 视图组件

视图组件位于`src/views`目录下，负责页面级别的布局和导航。每个视图组件通常对应一个路由，包含页面的主要结构和业务逻辑。

```mermaid
graph TD
Layout["Layout.vue"] --> Home["Home/index.vue"]
Layout --> TaskList["TaskList/index.vue"]
Layout --> AddTask["AddTask/index.vue"]
Layout --> Config["Config/index.vue"]
Layout --> About["About/index.vue"]
Layout --> Login["Login/index.vue"]
```

**图源**  
- [Layout.vue](file://src/frontEnd/src/views/Layout.vue)

**本节来源**  
- [Layout.vue](file://src/frontEnd/src/views/Layout.vue)

### 功能组件

功能组件位于`src/components`目录下，提供特定的业务功能。这些组件通常不直接与路由关联，而是被视图组件或其他组件引用。

```mermaid
classDiagram
class GuidedParamEditor {
+scanConfig : ScanConfig
+emits : update : scanConfig
+methods : handleInputChange()
+methods : validateInput()
}
class HttpCodeEditor {
+code : string
+language : string
+emits : update : code
+methods : formatCode()
+methods : highlightSyntax()
}
class TaskFilter {
+filters : TaskFilters
+emits : update : filters
+methods : applyFilter()
+methods : clearFilters()
}
class TaskSummary {
+task : Task
+methods : getStatusColor()
+methods : getProgress()
}
GuidedParamEditor --> TaskSummary : "使用"
HttpCodeEditor --> TaskSummary : "使用"
TaskFilter --> TaskList : "嵌入"
```

**图源**  
- [components/GuidedParamEditor.vue](file://src/frontEnd/src/components/GuidedParamEditor.vue)
- [components/HttpCodeEditor.vue](file://src/frontEnd/src/components/HttpCodeEditor.vue)
- [components/TaskFilter.vue](file://src/frontEnd/src/components/TaskFilter.vue)
- [components/TaskSummary.vue](file://src/frontEnd/src/components/TaskSummary.vue)

**本节来源**  
- [components/GuidedParamEditor.vue](file://src/frontEnd/src/components/GuidedParamEditor.vue)
- [components/HttpCodeEditor.vue](file://src/frontEnd/src/components/HttpCodeEditor.vue)
- [components/TaskFilter.vue](file://src/frontEnd/src/components/TaskFilter.vue)
- [components/TaskSummary.vue](file://src/frontEnd/src/components/TaskSummary.vue)

### UI组件

UI组件主要来自PrimeVue组件库，项目通过`unplugin-vue-components`插件实现了组件的自动导入，减少了手动导入的繁琐。

```mermaid
flowchart TD
A["UI组件使用流程"] --> B["在模板中使用PrimeVue组件"]
B --> C["unplugin-vue-components自动解析"]
C --> D["自动导入对应组件"]
D --> E["无需手动import"]
E --> F["减少代码冗余"]
```

**本节来源**  
- [vite.config.ts](file://src/frontEnd/vite.config.ts)

## Pinia状态管理

项目采用Pinia作为状态管理解决方案，通过模块化的方式管理应用状态。状态被划分为多个独立的store，每个store负责管理特定领域的状态。

### 状态管理架构

```mermaid
classDiagram
class useAuthStore {
-token : string | null
-userInfo : UserInfo | null
-isLocalMode : boolean
-authRequired : boolean
-backendHealthy : boolean
+isLoggedIn : boolean
+userName : string
+needAuth : boolean
+login(data : LoginRequest) : Promise~void~
+logout() : void
+checkAuth() : boolean
+initAuth() : void
+checkBackendHealth() : Promise~boolean~
}
class useTaskStore {
-taskList : Task[]
-currentTask : Task | null
-currentTaskDetail : TaskDetail | null
-loading : boolean
-filters : TaskFilters
-sortConfig : SortConfig
-selectedTaskIds : string[]
+taskStats : TaskStats
+filteredTaskList : Task[]
+sortedTaskList : Task[]
+fetchTaskList() : Promise~void~
+createTask(taskData : Partial~Task~) : Promise~Task~
+deleteTask(taskId : string) : Promise~void~
+stopTask(taskId : string) : Promise~void~
+updateTaskStatus(taskId : string, status : number) : void
}
class useConfigStore {
-apiBaseUrl : string
-theme : 'light' | 'dark'
-language : string
-headerRules : PersistentHeaderRule[]
-autoRefreshInterval : number
+loadConfig() : void
+saveConfig() : void
+updateTheme(newTheme : 'light' | 'dark') : void
+updateLanguage(newLanguage : string) : void
+setHeaderRules(rules : PersistentHeaderRule[]) : void
+updateAutoRefreshInterval(interval : number) : void
}
App --> useAuthStore : "使用"
App --> useTaskStore : "使用"
App --> useConfigStore : "使用"
useAuthStore --> useTaskStore : "影响"
useConfigStore --> App : "配置"
```

**图源**  
- [stores/auth.ts](file://src/frontEnd/src/stores/auth.ts)
- [stores/task.ts](file://src/frontEnd/src/stores/task.ts)
- [stores/config.ts](file://src/frontEnd/src/stores/config.ts)

**本节来源**  
- [stores/auth.ts](file://src/frontEnd/src/stores/auth.ts)
- [stores/task.ts](file://src/frontEnd/src/stores/task.ts)
- [stores/config.ts](file://src/frontEnd/src/stores/config.ts)

### 认证状态管理

认证状态管理支持本地和远程双模式。在本地访问时（localhost或127.0.0.1），系统自动进入本地模式，无需认证即可使用所有功能。

```mermaid
sequenceDiagram
participant A as App
participant AS as useAuthStore
participant R as request.ts
participant BE as 后端服务
A->>AS : initAuth()
AS->>AS : 检测访问模式
alt 本地模式
AS-->>A : 设置isLocalMode=true
AS-->>A : 视为已登录状态
else 远程模式
AS->>AS : 检查Token
alt 有Token
AS-->>A : 标记为已登录
else 无Token
A->>AS : 用户尝试访问受保护路由
AS->>AS : 检查路由元数据requiresAuth
AS->>A : 重定向到登录页
A->>AS : 用户登录
AS->>R : 发送登录请求
R->>BE : 带Authorization头的请求
BE-->>R : 返回Token
R-->>AS : 处理响应
AS->>AS : 存储Token和用户信息
AS-->>A : 登录成功
end
end
```

**图源**  
- [stores/auth.ts](file://src/frontEnd/src/stores/auth.ts)
- [api/request.ts](file://src/frontEnd/src/api/request.ts)

**本节来源**  
- [stores/auth.ts](file://src/frontEnd/src/stores/auth.ts)
- [api/request.ts](file://src/frontEnd/src/api/request.ts)

### 任务状态管理

任务状态管理是应用的核心，负责管理所有扫描任务的状态、过滤、排序和统计。

```mermaid
flowchart TD
A["任务状态管理流程"] --> B["获取任务列表"]
B --> C["应用过滤条件"]
C --> D["应用排序配置"]
D --> E["计算统计信息"]
E --> F["更新UI显示"]
subgraph "过滤条件"
C1["URL关键字"]
C2["报文关键字"]
C3["状态过滤"]
C4["时间范围"]
C5["注入状态"]
end
subgraph "排序字段"
D1["创建时间"]
D2["开始时间"]
D3["任务ID"]
D4["状态优先级"]
D5["URL长度"]
D6["错误数量"]
D7["日志数量"]
end
subgraph "统计信息"
E1["总任务数"]
E2["运行中"]
E3["等待中"]
E4["已完成"]
E5["失败"]
E6["已停止"]
E7["可注入"]
E8["不可注入"]
end
C --> C1
C --> C2
C --> C3
C --> C4
C --> C5
D --> D1
D --> D2
D --> D3
D --> D4
D --> D5
D --> D6
D --> D7
E --> E1
E --> E2
E --> E3
E --> E4
E --> E5
E --> E6
E --> E7
E --> E8
```

**图源**  
- [stores/task.ts](file://src/frontEnd/src/stores/task.ts)

**本节来源**  
- [stores/task.ts](file://src/frontEnd/src/stores/task.ts)

## Vue Router路由配置

项目使用Vue Router进行路由管理，实现了基于角色的访问控制和导航守卫机制。

### 路由配置

```mermaid
graph TD
A["路由配置"] --> B["根路由"]
B --> C["布局路由"]
C --> D["首页 /home"]
C --> E["任务列表 /tasks"]
C --> F["任务详情 /tasks/:id"]
C --> G["配置管理 /config"]
C --> H["添加任务 /add-task"]
C --> I["关于 /about"]
B --> J["登录 /login"]
B --> K["404重定向"]
style D fill:#4CAF50,stroke:#388E3C
style E fill:#2196F3,stroke:#1976D2
style F fill:#2196F3,stroke:#1976D2
style G fill:#FF9800,stroke:#F57C00
style H fill:#9C27B0,stroke:#7B1FA2
style I fill:#607D8B,stroke:#455A64
style J fill:#F44336,stroke:#D32F2F
```

**图源**  
- [router/index.ts](file://src/frontEnd/src/router/index.ts)

**本节来源**  
- [router/index.ts](file://src/frontEnd/src/router/index.ts)

### 导航守卫实现

导航守卫实现了复杂的访问控制逻辑，支持本地和远程双模式。

```mermaid
flowchart TD
A["全局前置守卫"] --> B["获取当前路由"]
B --> C["检查是否为本地模式"]
C --> |是| D["允许访问"]
C --> |否| E["检查是否需要认证"]
E --> F["需要认证且未登录"]
F --> |是| G["重定向到登录页"]
F --> |否| H["检查是否为登录页"]
H --> |是且已登录| I["重定向到首页"]
H --> |否| J["允许访问"]
style D fill:#4CAF50,stroke:#388E3C
style G fill:#F44336,stroke:#D32F2F
style I fill:#F44336,stroke:#D32F2F
style J fill:#4CAF50,stroke:#388E3C
```

**图源**  
- [router/guards.ts](file://src/frontEnd/src/router/guards.ts)

**本节来源**  
- [router/guards.ts](file://src/frontEnd/src/router/guards.ts)

## Vite构建工具优化

项目使用Vite作为构建工具，在`vite.config.ts`中进行了多项优化配置。

### 构建配置优化

```mermaid
classDiagram
class ViteConfig {
+plugins : Array
+resolve : Object
+server : Object
+css : Object
+build : Object
}
class Plugins {
+vue()
+AutoImport()
+Components()
+viteCompression()
}
class Resolve {
+alias : Object
}
class Server {
+port : number
+proxy : Object
}
class Build {
+outDir : string
+emptyOutDir : boolean
+assetsDir : string
+sourcemap : boolean
+minify : string
+chunkSizeWarningLimit : number
+rollupOptions : Object
}
ViteConfig --> Plugins
ViteConfig --> Resolve
ViteConfig --> Server
ViteConfig --> Build
```

**图源**  
- [vite.config.ts](file://src/frontEnd/vite.config.ts)

**本节来源**  
- [vite.config.ts](file://src/frontEnd/vite.config.ts)

### 代码分割配置

Vite配置中包含了详细的代码分割策略，通过Rollup的manualChunks功能实现。

```mermaid
graph TD
A["代码分割配置"] --> B["vendor chunk"]
A --> C["primevue chunk"]
A --> D["utils chunk"]
B --> |包含| B1["vue"]
B --> |包含| B2["vue-router"]
B --> |包含| B3["pinia"]
B --> |包含| B4["axios"]
C --> |包含| C1["primevue"]
D --> |包含| D1["lodash-es"]
D --> |包含| D2["dayjs"]
style B fill:#FFC107,stroke:#FFA000
style C fill:#FF9800,stroke:#F57C00
style D fill:#FF5722,stroke:#D84315
```

**图源**  
- [vite.config.ts](file://src/frontEnd/vite.config.ts)

**本节来源**  
- [vite.config.ts](file://src/frontEnd/vite.config.ts)

## TypeScript类型系统应用

项目充分利用TypeScript类型系统，定义了完整的类型体系，确保类型安全和开发体验。

### 类型定义架构

```mermaid
classDiagram
class BaseResponse {
+code : number
+success : boolean
+message : string
+data : T
}
class ListResponse~T~ {
+items : T[]
+total : number
+page : number
+pageSize : number
}
class UserInfo {
+username : string
+email? : string
+role? : string
}
class LoginRequest {
+username : string
+password : string
}
class LoginResponse {
+token : string
+userInfo : UserInfo
}
class TaskStatus {
PENDING = 0
RUNNING = 1
SUCCESS = 2
FAILED = 3
STOPPED = 4
TERMINATED = 5
}
class Task {
+engineid : number
+taskid : string
+scanUrl : string
+host : string
+status : TaskStatus
+createTime : string
+startTime? : string
+headers? : string[]
+body? : string
+options? : TaskOptions
+updateTime? : string
+remote_addr? : string
+injected? : boolean
+errors? : number
+logs? : number
}
class TaskOptions {
+level? : number
+risk? : number
+technique? : string
+dbms? : string
+threads? : number
}
class TaskFilters {
+urlKeyword? : string
+messageKeyword? : string
+status? : TaskStatus
+startDate? : string
+endDate? : string
+execStartDate? : string
+execEndDate? : string
+injectableStatus? : 'injectable' | 'not_injectable' | 'unknown'
}
class TaskStats {
+total : number
+running : number
+pending : number
+success : number
+failed : number
+stopped : number
+terminated : number
+injectable : number
+nonInjectable : number
+unknown : number
}
BaseResponse <|-- ListResponse
LoginResponse <|-- BaseResponse
Task <|-- TaskOptions
```

**图源**  
- [types/api.ts](file://src/frontEnd/src/types/api.ts)
- [types/common.ts](file://src/frontEnd/src/types/common.ts)
- [types/task.ts](file://src/frontEnd/src/types/task.ts)

**本节来源**  
- [types/api.ts](file://src/frontEnd/src/types/api.ts)
- [types/common.ts](file://src/frontEnd/src/types/common.ts)
- [types/task.ts](file://src/frontEnd/src/types/task.ts)